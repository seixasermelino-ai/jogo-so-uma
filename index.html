<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Palavras em Foco - Party Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        :root {
            --accent-color: #38bdf8;
            --accent-glow: rgba(56, 189, 248, 0.4);
            --bg-dark: #070b14;
            --surface: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        body, html {
            height: 100%;
            height: 100svh;
            margin: 0;
            padding: 0;
            overflow: hidden; 
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s ease;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            padding: 1.5rem;
            box-sizing: border-box;
        }

        .screen.active {
            display: flex;
        }

        /* --- HEADER --- */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--surface);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            border: 1px solid var(--border);
            margin-top: 0.5rem;
        }

        /* --- TEMAS --- */
        .color-palette {
            display: flex;
            gap: 0.6rem;
        }

        .theme-dot {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid transparent;
        }
        .theme-dot.active {
            transform: scale(1.25);
            border-color: white;
            box-shadow: 0 0 12px var(--accent-glow);
        }

        /* --- BOTÕES --- */
        .btn-action {
            border-radius: 1.25rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            cursor: pointer;
        }
        .btn-action:active { transform: scale(0.96); opacity: 0.9; }
        
        .btn-primary { 
            background: var(--accent-color); 
            color: #000; 
            box-shadow: 0 8px 24px var(--accent-glow);
        }
        
        .btn-draw {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: #ef4444;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 12px 40px rgba(239, 68, 68, 0.3);
            border: 8px solid rgba(239, 68, 68, 0.2);
            position: relative;
        }
        .btn-draw::after {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 2px solid #ef4444;
            animation: ripple 2s infinite;
        }

        @keyframes ripple {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.4); opacity: 0; }
        }

        .btn-ghost { 
            background: var(--surface); 
            color: #94a3b8; 
            border: 1px solid var(--border); 
        }

        .big-word {
            color: var(--accent-color);
            text-shadow: 0 0 40px var(--accent-glow);
            font-weight: 900;
            text-transform: uppercase;
            text-align: center;
            line-height: 1;
            display: block;
            transition: all 0.5s ease;
        }

        /* --- DICAS --- */
        .grid-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0 140px 0;
            mask-image: linear-gradient(to bottom, transparent, black 5%, black 90%, transparent);
        }

        .grid-zone {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .word-wrapper {
            position: relative;
            width: 100%;
        }

        .tip-box {
            background: var(--surface);
            border: 1px solid var(--border);
            color: white;
            text-transform: uppercase;
            font-weight: 700;
            border-radius: 1rem;
            width: 100%;
            aspect-ratio: 2 / 1;
            padding: 0.5rem;
            text-align: center;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .tip-box:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .delete-btn {
            position: absolute;
            right: -6px;
            top: -6px;
            width: 24px;
            height: 24px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            z-index: 10;
            border: 2px solid var(--bg-dark);
        }

        .nav-bar {
            position: fixed;
            bottom: 2rem;
            left: 1.5rem;
            right: 1.5rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }

        #peekOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(7, 11, 20, 0.98);
            backdrop-filter: blur(20px);
            z-index: 500;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .history-card {
            background: var(--surface);
            border-radius: 1.25rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            transition: transform 0.2s;
        }

        .pulse { animation: pulseAnim 2s infinite ease-in-out; }
        @keyframes pulseAnim {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.8; }
        }

        .countdown {
            font-size: 8rem;
            font-weight: 900;
            color: #ef4444;
            filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.4));
        }

        .small-timer {
            position: absolute;
            bottom: 60px;
            font-size: 0.75rem;
            font-weight: 800;
            color: #64748b;
            letter-spacing: 0.3em;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <!-- ETAPA 1: SORTEIO -->
        <div id="step1" class="screen active">
            <div class="top-bar">
                <button onclick="showHistory()" class="text-slate-400 hover:text-white transition-colors">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                </button>
                
                <div class="color-palette">
                    <div onclick="setTheme('#38bdf8')" class="theme-dot active" style="background: #38bdf8;"></div>
                    <div onclick="setTheme('#a855f7')" class="theme-dot" style="background: #a855f7;"></div>
                    <div onclick="setTheme('#ec4899')" class="theme-dot" style="background: #ec4899;"></div>
                    <div onclick="setTheme('#f59e0b')" class="theme-dot" style="background: #f59e0b;"></div>
                </div>
            </div>

            <div class="flex-1 flex flex-col items-center justify-center -mt-10">
                <div id="s1Content" class="w-full flex flex-col items-center gap-12">
                    <div class="text-center space-y-2">
                        <h2 class="text-white font-black text-2xl uppercase tracking-tighter">Pronto para jogar?</h2>
                        <p class="text-slate-500 text-sm font-medium">Toque no círculo para revelar seu destino</p>
                    </div>
                    
                    <button onclick="runS1Lottery()" class="btn-action btn-draw">SORTEAR</button>
                </div>
            </div>
            
            <div class="pb-4 text-center">
                <p class="text-[10px] text-slate-600 uppercase font-bold tracking-[0.2em]">Party Edition v2.0</p>
            </div>
        </div>

        <!-- ETAPA 2: DICAS -->
        <div id="step2" class="screen">
            <div class="flex justify-between items-center mb-6 pt-2">
                <div class="flex gap-3">
                    <button onclick="changeWordProcess()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-red-500/10 text-red-500 border border-red-500/20">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L22 22"/></svg>
                    </button>
                    <button onclick="peekWord()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-slate-500/10 text-slate-400 border border-white/10">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                </div>
                <h2 class="text-slate-500 font-extrabold uppercase tracking-widest text-[10px]">Crie suas Dicas</h2>
            </div>
            
            <div class="grid-container">
                <div id="gridZone" class="grid-zone"></div>
            </div>

            <div class="nav-bar">
                <button onclick="addNewTip()" class="btn-action btn-ghost flex-1 py-4">Nova Dica</button>
                <button onclick="goToStep3()" class="btn-action btn-primary flex-1 py-4">Finalizar</button>
            </div>
        </div>

        <!-- ETAPA 3: RESULTADO -->
        <div id="step3" class="screen">
            <div id="s3Content" class="flex flex-col h-full w-full pt-10"></div>
            <div class="nav-bar">
                <button onclick="resetApp()" class="btn-action btn-draw !w-full !h-auto !rounded-2xl !py-5 !text-sm !border-none">Jogar Novamente</button>
            </div>
        </div>

        <!-- OVERLAY DE HISTÓRICO / ESPIADA -->
        <div id="peekOverlay">
            <div id="peekContent" class="flex flex-col items-center justify-center w-full h-full"></div>
        </div>

    </div>

    <script>
        let commonWords = ["FOCO", "FORÇA", "FÉ", "VIDA", "PAZ", "BRASIL", "UNIÃO", "SONHO", "IDEIA"];
        let state = {
            selectedWord: "",
            tips: [],
            theme: '#38bdf8'
        };
        let wakeLock = null;

        async function loadWords() {
            try {
                const response = await fetch('palavras.txt');
                if (response.ok) {
                    const text = await response.text();
                    const lines = text.split(/\r?\n/).map(l => l.trim().toUpperCase()).filter(l => l.length > 0);
                    if (lines.length > 0) commonWords = lines;
                }
            } catch (e) {}
        }

        function setTheme(color) {
            state.theme = color;
            document.documentElement.style.setProperty('--accent-color', color);
            document.documentElement.style.setProperty('--accent-glow', color + '66');
            
            document.querySelectorAll('.theme-dot').forEach(dot => {
                dot.classList.remove('active');
                const dotBg = dot.style.backgroundColor;
                if(dotBg && (dotBg === color || rgbToHex(dotBg) === color)) {
                    dot.classList.add('active');
                }
            });
        }

        function rgbToHex(rgb) {
            if (rgb.startsWith('#')) return rgb;
            const match = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            if (!match) return rgb;
            const r = parseInt(match[1]);
            const g = parseInt(match[2]);
            const b = parseInt(match[3]);
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function saveToHistory() {
            const history = JSON.parse(localStorage.getItem('game_history') || '[]');
            const entry = {
                word: state.selectedWord,
                tips: state.tips.filter(t => t.length > 0 && t !== "DICA"),
                date: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                theme: state.theme
            };
            if (entry.word) {
                history.unshift(entry);
                localStorage.setItem('game_history', JSON.stringify(history.slice(0, 15)));
            }
        }

        function showHistory() {
            const overlay = document.getElementById('peekOverlay');
            const content = document.getElementById('peekContent');
            const history = JSON.parse(localStorage.getItem('game_history') || '[]');
            
            overlay.style.display = 'flex';
            content.innerHTML = `
                <div class="w-full flex justify-between items-center mb-8">
                     <h3 class="text-white font-black uppercase tracking-tight text-2xl">Histórico</h3>
                     <button onclick="clearHistory()" class="text-[10px] text-red-500 font-black uppercase bg-red-500/10 px-3 py-1 rounded-full">Limpar</button>
                </div>
                <div class="w-full overflow-y-auto max-h-[60vh] pr-1 space-y-4">
                    ${history.length === 0 ? '<p class="text-center text-slate-600 py-20 italic">Sem rodadas anteriores.</p>' : ''}
                    ${history.map(item => `
                        <div class="history-card" style="border-left: 4px solid ${item.theme}">
                            <div class="flex justify-between items-center mb-3">
                                <span class="font-black text-white text-lg">${item.word}</span>
                                <span class="text-[10px] text-slate-500 font-bold">${item.date}</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                ${item.tips.map(t => `<span class="text-[10px] bg-white/5 px-2.5 py-1 rounded-lg text-slate-300 uppercase font-extrabold border border-white/5">${t}</span>`).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
                <button onclick="document.getElementById('peekOverlay').style.display='none'" class="btn-action btn-ghost mt-10 w-full py-5 text-sm">Fechar</button>
            `;
        }

        function clearHistory() {
            localStorage.removeItem('game_history');
            showHistory();
        }

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (err) {}
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function adjustMainWordFont(el, word, customMax = 120) {
            if (!el) return;
            const containerWidth = el.parentElement.offsetWidth * 0.9; 
            let fontSize = containerWidth / (word.length * 0.7);
            fontSize = Math.min(fontSize, customMax);
            el.style.fontSize = fontSize + 'px';
        }

        function runS1Lottery() {
            requestWakeLock(); 
            const container = document.getElementById('s1Content');
            let count = 3;
            container.innerHTML = `<div class="countdown pulse">${count}</div>`;

            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    const cd = container.querySelector('.countdown');
                    if(cd) cd.textContent = count;
                } else {
                    clearInterval(timer);
                    state.selectedWord = commonWords[Math.floor(Math.random() * commonWords.length)];
                    displayS1Result();
                }
            }, 800);
        }

        function displayS1Result() {
            const container = document.getElementById('s1Content');
            container.innerHTML = `
                <div class="w-full text-center px-4 flex flex-col items-center">
                    <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.3em] mb-4">Sua palavra é:</p>
                    <div id="mainWordBox" class="big-word mb-12 pulse">${state.selectedWord}</div>
                    <button onclick="showScreen('step2'); renderStep2();" class="btn-action btn-primary w-full py-5 text-sm">Definir Dicas →</button>
                </div>
            `;
            const box = document.getElementById('mainWordBox');
            setTimeout(() => adjustMainWordFont(box, state.selectedWord), 50);
        }

        function renderStep2() {
            const zone = document.getElementById('gridZone');
            zone.innerHTML = '';
            
            if (state.tips.length === 0) {
                zone.innerHTML = `<div class="col-span-2 py-20 text-slate-700 font-bold text-center w-full opacity-50 text-xs uppercase tracking-widest">Nenhuma dica<br>ainda</div>`;
            }

            state.tips.forEach((tip, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'word-wrapper';
                
                const input = document.createElement('div');
                input.className = 'tip-box';
                input.contentEditable = true;
                input.textContent = tip;
                input.spellcheck = false;
                input.setAttribute('data-index', index);

                input.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        input.blur();
                        addNewTip();
                    }
                };

                input.onblur = () => {
                    state.tips[index] = input.textContent.trim().toUpperCase();
                    if (!state.tips[index]) {
                        state.tips.splice(index, 1);
                        renderStep2();
                    } else {
                        adjustTipFont(input);
                    }
                };

                const delBtn = document.createElement('button');
                delBtn.className = 'delete-btn';
                delBtn.innerHTML = '✕';
                delBtn.onclick = (e) => {
                    e.stopPropagation();
                    state.tips.splice(index, 1);
                    renderStep2();
                };

                wrapper.appendChild(input);
                wrapper.appendChild(delBtn);
                zone.appendChild(wrapper);
                adjustTipFont(input);
            });
        }

        function addNewTip() {
            state.tips.push("DICA");
            renderStep2();
            
            setTimeout(() => {
                const inputs = document.querySelectorAll('.tip-box');
                const last = inputs[inputs.length - 1];
                if (last) {
                    last.focus();
                    const range = document.createRange();
                    range.selectNodeContents(last);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            }, 50);
        }

        function adjustTipFont(el) {
            const text = el.textContent || "";
            const width = el.offsetWidth - 16; 
            let fontSize = width / (text.length * 0.7);
            el.style.fontSize = Math.min(Math.max(fontSize, 14), 22) + 'px';
        }

        function changeWordProcess() {
            const overlay = document.getElementById('peekOverlay');
            const content = document.getElementById('peekContent');
            overlay.style.display = 'flex';
            
            let count = 3;
            content.innerHTML = `<div class="countdown pulse">${count}</div><p class="mt-8 text-red-500 font-black uppercase tracking-widest text-[10px]">Trocando palavra...</p>`;

            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    const cd = content.querySelector('.countdown');
                    if(cd) cd.textContent = count;
                } else {
                    clearInterval(timer);
                    state.selectedWord = commonWords[Math.floor(Math.random() * commonWords.length)];
                    
                    let showCount = 4;
                    content.innerHTML = `
                        <p class="text-white/40 text-[10px] font-black mb-4 uppercase tracking-[0.4em]">Nova Palavra:</p>
                        <div id="newWordBox" class="big-word pulse">${state.selectedWord}</div>
                        <div class="small-timer">Retornando em ${showCount}s</div>
                    `;
                    const box = document.getElementById('newWordBox');
                    setTimeout(() => adjustMainWordFont(box, state.selectedWord, 160), 50);

                    const viewTimer = setInterval(() => {
                        showCount--;
                        if (showCount > 0) {
                            const timerText = content.querySelector('.small-timer');
                            if(timerText) timerText.textContent = `Retornando em ${showCount}s`;
                        } else {
                            clearInterval(viewTimer);
                            overlay.style.display = 'none';
                        }
                    }, 1000);
                }
            }, 800);
        }

        function peekWord() {
            const overlay = document.getElementById('peekOverlay');
            const content = document.getElementById('peekContent');
            overlay.style.display = 'flex';
            
            let count = 2;
            content.innerHTML = `<div class="countdown pulse">${count}</div>`;

            const prepTimer = setInterval(() => {
                count--;
                if (count > 0) {
                    const cd = content.querySelector('.countdown');
                    if(cd) cd.textContent = count;
                } else {
                    clearInterval(prepTimer);
                    
                    let showCount = 4;
                    content.innerHTML = `
                        <div id="peekWordBox" class="big-word pulse">${state.selectedWord}</div>
                        <div class="small-timer">Lembrando... (${showCount}s)</div>
                    `;
                    
                    const box = document.getElementById('peekWordBox');
                    setTimeout(() => adjustMainWordFont(box, state.selectedWord, 160), 50);

                    const outTimer = setInterval(() => {
                        showCount--;
                        if (showCount > 0) {
                            const timerText = content.querySelector('.small-timer');
                            if(timerText) timerText.textContent = `Lembrando... (${showCount}s)`;
                        } else {
                            clearInterval(outTimer);
                            overlay.style.display = 'none';
                        }
                    }, 1000);
                }
            }, 800);
        }

        function goToStep3() {
            showScreen('step3');
            saveToHistory();
            const container = document.getElementById('s3Content');
            let count = 3;
            container.innerHTML = `<div class="flex-1 flex flex-col items-center justify-center">
                <div class="countdown pulse">${count}</div>
                <p class="mt-8 text-slate-500 font-black uppercase tracking-[0.3em] text-[10px]">Passe o celular!</p>
            </div>`;

            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    const cd = container.querySelector('.countdown');
                    if(cd) cd.textContent = count;
                } else {
                    clearInterval(timer);
                    renderFinalResult();
                }
            }, 800);
        }

        function renderFinalResult() {
            const container = document.getElementById('s3Content');
            container.innerHTML = `
                <div class="flex flex-col items-center px-6">
                    <p class="text-white/40 text-[10px] font-black mb-2 uppercase tracking-[0.4em]">Revelado:</p>
                    <div id="finalWord" class="big-word mb-12">${state.selectedWord}</div>
                    
                    <div class="w-full">
                         <p class="text-slate-600 text-[10px] font-black mb-6 uppercase tracking-[0.2em] text-center">Dicas Fornecidas</p>
                         <div id="finalGrid" class="grid-zone"></div>
                    </div>
                </div>
            `;

            const finalWord = document.getElementById('finalWord');
            setTimeout(() => adjustMainWordFont(finalWord, state.selectedWord, 80), 50);

            const grid = document.getElementById('finalGrid');
            state.tips.forEach(tip => {
                if(tip && tip !== "DICA") {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'word-wrapper';
                    const item = document.createElement('div');
                    item.className = 'tip-box !border-dashed !border-white/20';
                    item.textContent = tip;
                    wrapper.appendChild(item);
                    grid.appendChild(wrapper);
                    setTimeout(() => adjustTipFont(item), 50);
                }
            });
        }

        function resetApp() {
            state.selectedWord = "";
            state.tips = [];
            showScreen('step1');
            const s1Content = document.getElementById('s1Content');
            s1Content.innerHTML = `
                <div class="text-center space-y-2">
                    <h2 class="text-white font-black text-2xl uppercase tracking-tighter">Pronto para jogar?</h2>
                    <p class="text-slate-500 text-sm font-medium">Toque no círculo para revelar seu destino</p>
                </div>
                <button onclick="runS1Lottery()" class="btn-action btn-draw">SORTEAR</button>
            `;
        }

        window.onload = loadWords;
    </script>
</body>
</html>
